<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TEST PRODUCTS</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center" href="#">
        <img src="img/logo_navbar.png" alt="Logo" height="40" class="me-2">
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link active" href="#">หน้าแรก</a></li>
          <li class="nav-item"><a class="nav-link" href="index2.html">สินค้าและบริการ</a></li>
          <li class="nav-item"><a class="nav-link" href="#">เกี่ยวกับเรา</a></li>
          <li class="nav-item"><a class="nav-link" href="#">โรงพยาบาลที่ให้บริการ</a></li>
          <li class="nav-item"><a class="nav-link" href="#">ติดต่อเรา</a></li>
          <li class="nav-item"><a class="nav-link" href="#">เข้าสู่ระบบ</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Product Section ส่วนของCard และ detail-->
  <section class="py-5 bg-light products-section">
    <div class="container">
      <h1 class="text-center mb-5 fw-bold">PRODUCTS</h1>

      <div class="row g-4 justify-content-center">

        <!-- Card 1 -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <div class="card h-100 shadow-sm openDetail"
              data-bs-toggle="modal" data-bs-target="#detailModal"
              data-title="LogInS LAB"
              data-images="imges/lisLab/lislab1.jpg,imges/lisLab/lislab2.jpg,imges/lisLab/lislab3.jpg,imges/lisLab/lislab4.jpg,imges/lisLab/lislab5.jpg,imges/lisLab/lislab6.jpg"
              data-desc="ปัจจุบัน บริษัท แล็บ พลัส จำกัด ได้พัฒนาปรับปรุงโปรแกรม LIS ของบริษัทฯ ให้สามารถรองรับการทำงานของห้องปฏิบัติการในโรงพยาบาลได้ทุกขนาด รวมถึงพัฒนาคุณลักษณะและความสามารถของโปรแกรม ให้สอดคล้องกับมาตรฐานระบบ LIS ของสภาเทคนิคการแพทย์">
            
            <img src="img/1437121.png" class="card-img-top p-3" alt="LogInS LAB">
            <div class="card-body text-center">
              <h5 class="card-title fw-bold">LogInS LAB</h5>
              <p class="card-text text-muted">ปัจจุบัน บริษัท แล็บ พลัส จำกัด ได้พัฒนาปรับปรุงโปรแกรม LIS ของบริษัทฯ....</p>
              <button class="btn btn-outline-primary btn-sm mt-2">Open Detail</button>
            </div>
          </div>
        </div>

        <!-- Card 2 -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <div class="card h-100 shadow-sm openDetail"
              data-bs-toggle="modal" data-bs-target="#detailModal"
              data-title="โปรแกรมธนาคารเลือด (Blood Bank)"
              data-images="imges/BloodBank/bloodbank1.jpg,imges/BloodBank/bloodbank2.jpg,imges/BloodBank/bloodbank3.jpg,imges/BloodBank/bloodbank4.jpg,imges/BloodBank/bloodbank5.jpg,imges/BloodBank/bloodbank6.jpg"
              data-desc="โปรแกรมธนาคารเลือด (Blood Bank) จัดการบริหารคลังเลือด ข้อมูลการบริจาค งานบริการเลือด เรียกดูรายงานและสถิติต่างๆ"
              data-video="https://www.youtube.com/embed/wNAtrMZj2EQ">

            <img src="img/blood.png" class="card-img-top p-3" alt="Blood Bank">
            <div class="card-body text-center">
              <h5 class="card-title fw-bold">โปรแกรมธนาคารเลือด <br>(Blood Bank)<br></h5>
              <p class="card-text text-muted">โปรแกรมธนาคารเลือด (Blood Bank) จัดการบริหารคลังเลือด...</p>
              <button class="btn btn-outline-primary btn-sm mt-2">Open Detail</button>
            </div>
          </div>
        </div>

        <!-- Card 3 -->
        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
          <div class="card h-100 shadow-sm openDetail"
              data-bs-toggle="modal" data-bs-target="#detailModal"
              data-title="โปรแกรมแล็บออนไลน์"
              data-images="imges/LabOnline/Labonline1.png,imges/LabOnline/Labonline2.png,imges/LabOnline/Labonline3.png,imges/LabOnline/Labonline4.png,imges/LabOnline/Labonline5.png"
              data-desc="โปรแกรมแล็บออนไลน์ รองรับการทำงานของห้องปฏิบัติการในส่วน การสั่งตรวจ,เรียกดูผลตรวจ,ข้อมูลผู้ป่วย และออกผลรายงานข้อมูลต่างๆ ทำงานผ่านเว็บบราวเซอร์ไม่ต้องติดตั้งโปรแกรม รองรับการทำงานผ่านมือถือและแท็บเล็ต">
            
            <img src="img/labonline.png" class="card-img-top p-3" alt="Lab Online">
            <div class="card-body text-center">
              <h5 class="card-title fw-bold">โปรแกรมแล็บออนไลน์</h5>
              <p class="card-text text-muted">โปรแกรมแล็บออนไลน์ รองรับการทำงานของห้องปฏิบัติการในส่วน...</p>
              <button class="btn btn-outline-primary btn-sm mt-2">Open Detail</button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Modal -->
  <div class="modal fade" id="detailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title fw-bold" id="detailTitleHeader"></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">

          <!-- Carousel -->
          <div id="detailCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
            <div class="carousel-inner" id="carouselImages"></div>
            <button class="carousel-control-prev" type="button" data-bs-target="#detailCarousel" data-bs-slide="prev">
              <span class="carousel-control-prev-icon"></span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#detailCarousel" data-bs-slide="next">
              <span class="carousel-control-next-icon"></span>
            </button>
          </div>

          <p id="detailDesc" class="text-start px-3"></p>

          <div id="videoSection" class="mt-3 d-none">
            <h5 class="mb-3 fw-bold">วีดีโอเพิ่มเติม</h5>
            <div class="ratio ratio-16x9">
              <iframe id="video-frame" src="" allowfullscreen></iframe>
            </div>
          </div>

            <div id="imgPopup">
                <span class="popup-close">&times;</span>
                <span class="btn-nav btn-prev"><i class="fas fa-chevron-left"></i></span>
                <img id="popupImg" src="">
                <span class="btn-nav btn-next"><i class="fas fa-chevron-right"></i></span>
            </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
        const modalEl = document.getElementById('detailModal');
        if (!modalEl) {
            console.error("Modal element with ID 'detailModal' is missing.");
            return;
        }
        const bsModal = new bootstrap.Modal(modalEl);
        
        // ตรวจสอบการมีอยู่ขององค์ประกอบ Lightbox/Video
        const popup = document.getElementById("imgPopup");
        const popupImg = document.getElementById("popupImg");
        const prevBtn = document.querySelector(".btn-prev");
        const nextBtn = document.querySelector(".btn-next");
        const closeBtn = document.querySelector(".popup-close");
        const videoSection = document.getElementById("videoSection");
        const videoFrame = document.getElementById("video-frame");
        
        let currentImages = [];
        let currentIndex = 0;

        //  ฟังก์ชันเปิด/ปิด/เลื่อนรูปใน Lightbox
        function openLightbox() {
            if (currentImages.length === 0 || !popupImg || !popup) {
                return; // ป้องกัน Error เมื่อไม่มีรูปภาพ หรือองค์ประกอบ lightbox ไม่ครบ
            }
            popupImg.src = currentImages[currentIndex].trim();
            popup.style.display = "flex";
        }

        function closeLightbox() {
            if (popup) popup.style.display = "none";
        }

        function showNext() {
            if (currentImages.length > 0) {
                currentIndex = (currentIndex + 1) % currentImages.length;
                openLightbox();
            }
        }

        function showPrev() {
            if (currentImages.length > 0) {
                currentIndex = (currentIndex - 1 + currentImages.length) % currentImages.length;
                openLightbox();
            }
        }
        //  Event Listener Lightbox (ตรวจสอบก่อนว่าปุ่มมีอยู่)
        if (nextBtn) nextBtn.addEventListener("click", showNext);
        if (prevBtn) prevBtn.addEventListener("click", showPrev);
        if (closeBtn) closeBtn.addEventListener("click", closeLightbox);
        if (popup) {
            popup.addEventListener("click", (e) => {
                if (e.target === popup) closeLightbox();
            });
        }

        //  เปิด modal เมื่อกดการ์ด
        document.querySelectorAll('.openDetail').forEach(card => {
            card.addEventListener('click', () => {
                const title = card.dataset.title || '';
                const desc = card.dataset.desc || '';
                const images = card.dataset.images ? card.dataset.images.split(',') : [];
                const video = card.dataset.video || '';

                document.getElementById('detailTitleHeader').textContent = title;
                document.getElementById('detailDesc').textContent = desc;

                //  สร้าง carousel images
                const carouselContainer = document.getElementById('carouselImages');
                if (carouselContainer) {
                    carouselContainer.innerHTML = images.map((src, i) => `
                        <div class="carousel-item ${i === 0 ? 'active' : ''}">
                        <img src="${src.trim()}" class="d-block w-100 rounded shadow detail-img"
                            style="max-height:350px;object-fit:contain;cursor:pointer;">
                        </div>
                    `).join('');
                }


                //  แสดง/ซ่อนวิดีโอ (ตรวจสอบ videoSection และ videoFrame ก่อนใช้)
                if (videoSection && videoFrame) {
                    if (video) {
                        videoSection.classList.remove("d-none");
                        videoFrame.src = video;
                    } else {
                        videoSection.classList.add("d-none");
                        videoFrame.src = "";
                    }
                }


                bsModal.show();

                //  เก็บรูปไว้สำหรับ lightbox
                currentImages = images;

            
                setTimeout(() => {
                    document.querySelectorAll('.detail-img').forEach((img, index) => {
                    img.addEventListener('click', () => {
                        currentIndex = index;
                        openLightbox();
                    });
                    });
                }, 300);
            });
        });

        modalEl.addEventListener('hidden.bs.modal', () => {
            // ล้าง src ของ iframe เพื่อหยุดวิดีโอ
            if (videoFrame) {
                videoFrame.src = ""; 
            }
        });
    });
</script>

</body>
</html>
